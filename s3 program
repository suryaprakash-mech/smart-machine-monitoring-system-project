import json
import boto3
import time
import uuid

# Initialize DynamoDB client
dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('HealthMonitoringData')

def lambda_handler(event, context):
    try:
        # Extract health monitoring data from the event
        device_id = event.get("device_id", str(uuid.uuid4()))  # Unique ID if not provided
        speed = event["speed"]
        vibration = event["vibration"]
        temperature = event["temperature"]
        timestamp = int(time.time())  # Unix timestamp

        # Store data in DynamoDB
        response = table.put_item(
            Item={
                "device_id": device_id,
                "timestamp": timestamp,
                "speed": speed,
                "vibration": vibration,
                "temperature": temperature
            }
        )

        return {
            "statusCode": 200,
            "body": json.dumps({"message": "Data stored successfully", "device_id": device_id})
        }
    
    except Exception as e:
        return {
            "statusCode": 500,
            "body": json.dumps({"error": str(e)})
        }
